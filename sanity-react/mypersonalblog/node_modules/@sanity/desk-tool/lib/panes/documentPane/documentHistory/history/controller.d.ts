import { SanityClient } from '@sanity/client';
import { Observable } from 'rxjs';
import { ObjectDiff } from '@sanity/diff';
import { Timeline } from './timeline';
import { RemoteSnapshotVersionEvent, Chunk } from './types';
export declare type Options = {
    timeline: Timeline;
    client: SanityClient;
    documentId: string;
    handler: (err: Error | null, controller: Controller) => void;
};
/**
 * The controller is responsible for fetching information
 * about a document and maintaining a Timeline.
 */
export declare class Controller {
    timeline: Timeline;
    client: SanityClient;
    handler: Options['handler'];
    version: number;
    /**
     * The selection state represents the  different states of the current selection:
     * - inactive: No selection is active.
     * - rev: A selection is active for a single revision.
     * - range: A selection is active for a range and we have all the data needed to render it.
     * - loading: A selection is active, but we don't have the entries yet.
     * - invalid: The selection picked is invalid.
     */
    selectionState: 'inactive' | 'rev' | 'range' | 'loading' | 'invalid';
    constructor(options: Options);
    private _aligner;
    private _fetchMore;
    private _fetchAtLeast;
    private _isRunning;
    private _didErr;
    private _since;
    private _sinceTime;
    private _rev;
    private _revTime;
    clearRange(): void;
    setRange(since: string | null, rev: string | null): void;
    setLoadMore(state: boolean): void;
    get sinceTime(): Chunk | null;
    get revTime(): Chunk | null;
    get realRevChunk(): Chunk;
    /** Returns true when there's an older revision we want to render. */
    onOlderRevision(): boolean;
    /** Returns true when the changes panel should be active. */
    changesPanelActive(): boolean;
    findRangeForNewRev(rev: Chunk): [string | null, string | null];
    findRangeForNewSince(since: Chunk): [string, string | null];
    setRevTime(rev: string | null): void;
    setSinceTime(since: string | null): void;
    sinceAttributes(): Record<string, unknown> | null;
    displayed(): Record<string, unknown> | null;
    private _reconstruction?;
    setReconstruction(since: Chunk | null, rev: Chunk): void;
    currentDiff(): ({
        action: "added";
        isChanged: true;
        fromValue: null | undefined;
        toValue: null;
        annotation: any;
    } & {
        type: "null";
    }) | ({
        action: "removed";
        isChanged: true;
        fromValue: null;
        toValue: null | undefined;
        annotation: any;
    } & {
        type: "null";
    }) | ({
        action: "changed";
        isChanged: true;
        fromValue: null;
        toValue: null;
        annotation: any;
    } & {
        type: "null";
    }) | ({
        action: "unchanged";
        isChanged: false;
        fromValue: null;
        toValue: null;
    } & {
        type: "null";
    }) | ({
        action: "added";
        isChanged: true;
        fromValue: null | undefined;
        toValue: string;
        annotation: any;
    } & {
        type: "string";
        segments: import("@sanity/diff").StringDiffSegment<any>[];
    }) | ({
        action: "removed";
        isChanged: true;
        fromValue: string;
        toValue: null | undefined;
        annotation: any;
    } & {
        type: "string";
        segments: import("@sanity/diff").StringDiffSegment<any>[];
    }) | ({
        action: "changed";
        isChanged: true;
        fromValue: string;
        toValue: string;
        annotation: any;
    } & {
        type: "string";
        segments: import("@sanity/diff").StringDiffSegment<any>[];
    }) | ({
        action: "unchanged";
        isChanged: false;
        fromValue: string;
        toValue: string;
    } & {
        type: "string";
        segments: import("@sanity/diff").StringDiffSegment<any>[];
    }) | ({
        action: "added";
        isChanged: true;
        fromValue: null | undefined;
        toValue: number;
        annotation: any;
    } & {
        type: "number";
    }) | ({
        action: "removed";
        isChanged: true;
        fromValue: number;
        toValue: null | undefined;
        annotation: any;
    } & {
        type: "number";
    }) | ({
        action: "changed";
        isChanged: true;
        fromValue: number;
        toValue: number;
        annotation: any;
    } & {
        type: "number";
    }) | ({
        action: "unchanged";
        isChanged: false;
        fromValue: number;
        toValue: number;
    } & {
        type: "number";
    }) | ({
        action: "added";
        isChanged: true;
        fromValue: null | undefined;
        toValue: boolean;
        annotation: any;
    } & {
        type: "boolean";
    }) | ({
        action: "removed";
        isChanged: true;
        fromValue: boolean;
        toValue: null | undefined;
        annotation: any;
    } & {
        type: "boolean";
    }) | ({
        action: "changed";
        isChanged: true;
        fromValue: boolean;
        toValue: boolean;
        annotation: any;
    } & {
        type: "boolean";
    }) | ({
        action: "unchanged";
        isChanged: false;
        fromValue: boolean;
        toValue: boolean;
    } & {
        type: "boolean";
    }) | ({
        action: "added";
        isChanged: true;
        fromValue: null | undefined;
        toValue: Record<string, any>;
        annotation: any;
    } & {
        type: "object";
        fields: Record<string, import("@sanity/diff").Diff<any>>;
    }) | ({
        action: "removed";
        isChanged: true;
        fromValue: Record<string, any>;
        toValue: null | undefined;
        annotation: any;
    } & {
        type: "object";
        fields: Record<string, import("@sanity/diff").Diff<any>>;
    }) | ({
        action: "changed";
        isChanged: true;
        fromValue: Record<string, any>;
        toValue: Record<string, any>;
        annotation: any;
    } & {
        type: "object";
        fields: Record<string, import("@sanity/diff").Diff<any>>;
    }) | ({
        action: "unchanged";
        isChanged: false;
        fromValue: Record<string, any>;
        toValue: Record<string, any>;
    } & {
        type: "object";
        fields: Record<string, import("@sanity/diff").Diff<any>>;
    }) | ({
        action: "added";
        isChanged: true;
        fromValue: null | undefined;
        toValue: unknown[];
        annotation: any;
    } & {
        type: "array";
        items: import("@sanity/diff").ItemDiff<any>[];
    }) | ({
        action: "removed";
        isChanged: true;
        fromValue: unknown[];
        toValue: null | undefined;
        annotation: any;
    } & {
        type: "array";
        items: import("@sanity/diff").ItemDiff<any>[];
    }) | ({
        action: "changed";
        isChanged: true;
        fromValue: unknown[];
        toValue: unknown[];
        annotation: any;
    } & {
        type: "array";
        items: import("@sanity/diff").ItemDiff<any>[];
    }) | ({
        action: "unchanged";
        isChanged: false;
        fromValue: unknown[];
        toValue: unknown[];
    } & {
        type: "array";
        items: import("@sanity/diff").ItemDiff<any>[];
    }) | import("@sanity/diff").TypeChangeDiff<any> | null;
    currentObjectDiff(): ObjectDiff<any> | null;
    handleRemoteMutation(ev: RemoteSnapshotVersionEvent): void;
    start(): void;
    private tick;
    private fetchMoreTransactions;
    private markChange;
}
export declare function createObservableController(options: Omit<Options, 'handler'>): Observable<{
    historyController: Controller;
}>;
